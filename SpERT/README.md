## Introduction

基于Pytorch的SpERT实体关系抽取模型实现，[官方源码](https://github.com/lavis-nlp/spert)。官方源码封装的非常好，适合有一定基础的人去阅读，所以我修改了部分源码，
并做了相应的注释，做了一部分优化，以便能够更加方便的了解学习SpERT模型。如果有错误，请随时指正！

## Requirements

* python 3.7
* torch = 1.12.1
* numpy
* matplotlib
* transformers

## DataSet
数据集为百度关系抽取数据集，句子最大长度为294，最小长度为5，平均长度为50。

## Train
训练模型

    python main.py
    
## Results

|SpERT Model | Val_precision | Val_recall | Val_f1 | Test_precision | Test_recall | Test_f1 | Time |
|:-----| :----- | :-----| :----- |:----- |:----- |:----- |:-----|
|Entity classify | 0.67 | 0.86 | 0.76 | 0.74 | 0.86 | 0.80 | 148m |
|Relation classify | 0.45 | 0.79 | 0.57 | 0.53 | 0.79 | 0.64 | 148m |

训练loss曲线  
![loss_curve](https://github.com/lisj1211/NLP/blob/main/SpERT/picture/loss.png)  

与CasRel的loss进行对比  
![loss_curve](https://github.com/lisj1211/NLP/blob/main/SpERT/picture/compare.png) 


## Analysis

SpERT模型在实体抽取任务上表现较为优秀，但在关系抽取中表现一般。与CasRel模型进行对比，差距还是有点大，这个对比结果与部分博客存在差异，他们都是SpERT模型较为优秀一点。
分析结果可以发现，SpERT模型的recall较高，说明能预测出大部分真实关系，但precision很低，表现为预测出很多假关系。以下为部分测试集样例。 

* 样例一:   
```
    {
        "text": "《铁杉树丛第三季》是由伊莱·罗斯执导，法米克·詹森/比尔·斯卡斯加德/兰登·莱伯隆/卡内赫迪奥·霍恩/乔尔·德·拉·冯特等主演的电视剧，于2015年开播"
        "entity": [('法米克·詹森', '人物'), ('伊莱·罗斯', '人物'), ('比尔·斯卡斯加德', '人物'), ('铁杉树丛第三季', '影视作品')]
        "relation": [('铁杉树丛第三季', '主演', '法米克·詹森'), ('铁杉树丛第三季', '导演', '伊莱·罗斯'), ('铁杉树丛第三季', '主演', '比尔·斯卡斯加德')]
    }
 ```
  
CasRel模型预测结果为:  
```
    {
        "relation": [('铁杉树丛第三季', '导演', '伊莱·罗斯')]
    }
 ```
  
SpERT模型预测结果为:  
 ```
  {
    "entity": {('卡内赫迪奥·霍恩', '人物'), ('比尔·斯卡斯加德', '人物'),('伊莱·罗斯', '人物'), ('乔尔·德·拉·冯特', '人物'), ('法米克·詹森', '人物'), ('兰登·莱伯隆', '人物'), ('2015年', '日期'), ('铁杉树丛第三季', '影视作品')}
    "relation": {('铁杉树丛第三季', '主演', '卡内赫迪奥·霍恩'), ('铁杉树丛第三季', '上映时间', '2015年'), ('铁杉树丛第三季', '主演', '比尔·斯卡斯加德'),('铁杉树丛第三季', '导演', '伊莱·罗斯'), ('铁杉树丛第三季', '主演', '乔尔·德·拉·冯特'), ('铁杉树丛第三季', '主演', '法米克·詹森'), ('铁杉树丛第三季', '主演', '兰登·莱伯隆')}
  }
  ```
  
* 样例二: 
```
    {
        "text": "基本资料　　歌曲名称：为你叫好1歌手：吕薇　　所属专辑：《但愿人长久》歌词　　歌手：吕薇　　词：清风 曲：刘青"
        "entity": [('但愿人长久', '音乐专辑'), ('吕薇', '人物'), ('为你叫好', '歌曲'), ('清风', '人物'), ('刘青', '人物')]
        "relation": [('为你叫好', '作曲', '刘青'), ('为你叫好', '歌手', '吕薇'), ('为你叫好', '作词', '清风'), ('为你叫好', '所属专辑', '但愿人长久')]
    }
 ```

CasRel模型预测结果为:  
```
    {
        "relation": [('为你叫好', '作曲', '刘青'), ('为你叫好', '歌手', '吕薇'), ('为你叫好', '所属专辑', '但愿人长久'), ('为你叫好', '作词', '清风')]
    }
 ```
  
SpERT模型预测结果为:  
 ```
  {
    "entity": {('但愿人长久', '音乐专辑'), ('吕薇', '人物'), ('为你叫好', '歌曲'), ('清风', '人物'), ('刘青', '人物')}
    "relation": {('为你叫好', '作曲', '清风'), ('为你叫好', '作词', '刘青'), ('为你叫好', '作曲', '吕薇'), ('为你叫好', '作曲', '刘青'), ('为你叫好', '所属专辑', '但愿人长久'), ('为你叫好', '歌手', '吕薇'), ('为你叫好', '作词', '清风')}
  }
  ```
可以发现，SpERT预测出了非常多的关系三元组，其中有些是错误的。但是非常神奇的是，SpERT同时也预测出了真实的但未被标注的关系三元组。这应该与SpERT构建待预测实体有关，因为
输入阶段，SpERT随机选取长度不等的片段当做输入来预测实体。当然这只是我的猜测。真实情况还有待考究。总之，SpERT模型虽然表现不如CasRel模型，但能预测出真实但未被标注的关系三元组，
也说明了该模型的强大之处。
## ToDo

之后复现哪个模型还未明确，待定！。

## Reference
[1] [SpERT: Span-based Entity and Relation Transformer](https://arxiv.org/abs/1909.07755)  
